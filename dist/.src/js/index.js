var model=function(){var public={getSrc:function(){function treeToObj(tree){function extension(a){var b=a.match(/[.]/g);return null===b?"":1===b.length?hide?"":a.match(/\w+$/)[0]:b.length>1?a.match(/\w+$/)[0]:void 0}function src(a){var b="";if(0===a.length)return b;for(var c=0;c<a.length;c++)b=b+a[c]+"/";return b}var objTree={},arrTree,arrPoint=[],pointer=objTree,leng,buffer,depth,_depth,name,hide,target;arrTree=tree.replace(/.\n/,"").split(/\n/),leng=arrTree.length;for(var i=0;leng-1>i;i++)if(depth=arrPoint.length+1,_depth=arrTree[i].match(/[|]/g).length,name=arrTree[i].replace(/[|]/g,"").replace(/^\s+/g,""),hide=!!name.match(/^[.]/),_depth===depth)pointer[name]={},target=pointer[name],target.____name=name,target.____extension=extension(name),target.____src="./"+src(arrPoint)+name,target.____hide=hide,buffer=name;else if(_depth===depth+1)arrPoint.push(buffer),pointer=pointer[buffer],pointer[name]={},target=pointer[name],target.____name=name,target.____extension=extension(name),target.____src="./"+src(arrPoint)+name,target.____hide=hide,buffer=name;else if(depth>_depth){var up=depth-_depth;if(arrPoint.length=arrPoint.length-up,0===arrPoint.length)pointer=objTree;else{for(var father="objTree",n=0;n<arrPoint.length;n++)father=father+'["'+arrPoint[n]+'"]';pointer=eval(father)}pointer[name]={},target=pointer[name],target.____name=name,target.____extension=extension(name),target.____src="./"+src(arrPoint)+name,target.____hide=hide,buffer=name}return objTree}var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&(_tree=xhr.responseText,_src=treeToObj(_tree),localStorage.setItem("src",JSON.stringify(_src)),_pointer=_src,_arrPoint=[],view.listLoad())},xhr.open("GET","./tree.txt",!0),xhr.send()},loadSrc:function(){_src=JSON.parse(localStorage.getItem("src")),_pointer=_src,_arrPoint=[],view.listLoad()},getConfig:function(){localStorage.getItem("config")?_config=JSON.parse(localStorage.getItem("config")):(_config={hide:!1,sys:!1,button:!0},localStorage.setItem("config",JSON.stringify(_config))),view.pageInit()},setConfig:function(){localStorage.setItem("config",JSON.stringify(_config))},openText:function(a){localStorage.setItem("openText",a),setTimeout(function(){window.open("./.open/text.html")},0)},openImage:function(a,b){localStorage.setItem("openImage",a),localStorage.setItem("openImageSrc",b),setTimeout(function(){window.open("./.open/image.html")},0)},openAudio:function(a){localStorage.setItem("openAudio",a),setTimeout(function(){window.open("./.open/audio.html")},0)}};return public}(),view=function(){function renderStyle(a,b,c){return c=c||!1,c?+window.getComputedStyle(a,null)[b+""].match(/\d*/)[0]:window.getComputedStyle(a,null)[b+""]}var public={pageInit:function(){var a=document.getElementById("config-hide-checkbox"),b=document.getElementById("config-sys-checkbox"),c=document.getElementById("config-floatButton-checkbox");$("#article").css("height",winHei-56+"px"),a.checked=_config.hide?"checked":"",b.checked=_config.sys?"checked":"",_config.button?($("#float-button").css("display","block"),c.checked="checked"):c.checked="",controller.regEvents()},listLoad:function(){function mySome(a,b){for(var c=a.length,d=b.toLowerCase(),e=0;c>e;e++)if(a[e]===d)return!0;return!1}function setType(a){type.classList.add(mySome(ext.folder,a.____extension)?"life-type-folder":mySome(ext.text,a.____extension)?"life-type-text":mySome(ext.image,a.____extension)?"life-type-image":mySome(ext.audio,a.____extension)?"life-type-audio":mySome(ext.video,a.____extension)?"life-type-video":"life-type-other")}function animateClick(a,b){var c,d,e=document.createElement("div");e.classList.add("wave"),""===b.id.slice(4)?(c=a.changedTouches[0].pageX+"px",d=a.changedTouches[0].pageY-56+"px"):(c=a.changedTouches[0].pageX+"px",d=_pointer===_src?a.changedTouches[0].pageY-73*b.id.slice(4)-56+"px":a.changedTouches[0].pageY-73*b.id.slice(4)-129+"px"),e.style.left=c,e.style.top=d,e.classList.add("ani-wave"),b.appendChild(e)}var list=Object.keys(_pointer),leng=list.length,ext={folder:[""],text:["txt","html","css","js","json","bat","command"],image:["jpg","jpeg","bmp","png","gif","svg"],audio:["mp3","wav","m4a"],video:["mp4","avi"],other:[]},div,type,text,fileList,fileLeng,configHide=_config.hide,configSys=_config.sys;_pointer!==_src&&(div=document.createElement("div"),type=document.createElement("div"),text=document.createElement("span"),div.classList.add("file"),div.id="back",type.classList.add("life-type-folder"),text.classList.add("life-text"),text.innerHTML="../",div.appendChild(type),div.appendChild(text),$("#article").append(div),$(div).one("touchend",function(e){var file=document.getElementsByClassName("file"),fileLeng=file.length;animateClick(e,this),ae(file[0]).clear()._play("file-hide",function(){if(_arrPoint.length=_arrPoint.length-1,0===_arrPoint.length)_pointer=_src;else{for(var father="_src",n=0;n<_arrPoint.length;n++)father=father+'["'+_arrPoint[n]+'"]';_pointer=eval(father)}$(".file").remove(),view.listLoad()});for(var i=1;fileLeng>i;i++)ae(file[i]).clear()._play("file-hide")}));for(var i=0,No=0;leng>i;i++)if("____"!==list[i].substr(0,4)&&(configHide||"."!==list[i].substr(0,1))&&(configSys||"index.html"!==list[i]&&"index.haml"!==list[i]&&"tree.txt"!==list[i]&&"create-tree.command"!==list[i])){if(div=document.createElement("div"),type=document.createElement("div"),text=document.createElement("span"),div.classList.add("file"),div.src=list[i],div.id="file"+No,No+=1,setType(_pointer[list[i]]),text.classList.add("life-text"),text.innerHTML=list[i],div.appendChild(type),div.appendChild(text),$("#article").append(div),renderStyle(text,"width",!0)>winWid-88){var cache=text.innerHTML;text.innerHTML=cache.substring(0,~~((winWid-88)/22))+"..."+cache.substring(cache.length-5,cache.length)}$(div).one("touchend",function(a){var b=this.src,c=_pointer[b],d=document.getElementsByClassName("file"),e=d.length;if(""===c.____extension){animateClick(a,this),ae(d[0]).clear()._play("file-hide",function(){_pointer=c,_arrPoint.push(b),$(".file").remove(),view.listLoad()});for(var f=1;e>f;f++)ae(d[f]).clear()._play("file-hide")}else mySome(ext.text,c.____extension)?model.openText(JSON.stringify(c)):mySome(ext.image,c.____extension)?model.openImage(JSON.stringify(c),JSON.stringify(_pointer)):mySome(ext.audio,c.____extension)&&model.openAudio(JSON.stringify(c))})}fileList=document.getElementsByClassName("file"),fileLeng=fileList.length;for(var u=0;fileLeng>u;u++)setTimeout(function(a){ae(a)._play("file-show")},100*u,fileList[u]);if(_pointer===_src)$("#title").html(window.location.origin.replace(/^\w+:\/\//,""));else{for(var m=".",n=0;n<_arrPoint.length;n++)m=m+"/"+_arrPoint[n];m.length>(winWid-72)/16&&(m="..."),$("#title").html(m)}},addMask:function(){var a=document.createElement("div");a.style.height=winHei+"px",a.style.width=winWid+"px",a.style.position="absolute",a.style.zIndex="10",a.id="mask",$("body").prepend(a)},addConfirm:function(a,b,c){var d=document.createElement("div");c=c||!1,b=b||function(){},d.innerHTML="<div>"+a+'</div><span id="confirm-yes">确认</span>',d.classList.add("confirm"),view.addMask(),$("#mask").css({"background-color":"rgba(0,0,0,0.4)","z-index":"20"}).append(d).on("tap",function(a){a.target===this&&$("#mask").remove()}),$("#confirm-yes").on("tap",function(){console.log("!"),$("#mask").remove(),b()}),c||($(d).append('<span id="confirm-no">取消</span>'),$("#confirm-no").on("tap",function(){$("#mask").remove()})),ae(d)._play("confirm-show"),d.style.marginTop=-renderStyle(d,"height",!0)/2+"px"}},winHei=document.documentElement.clientHeight,winWid=document.documentElement.clientWidth;return ae("body")._add({id:"file-show","final":!0,0:"opacity:0",500:"opacity:1"}),ae("body")._add({id:"file-hide","final":!0,0:"opacity:1",500:"opacity:0"}),ae("body")._add({id:"confirm-show","final":!0,0:"opacity:0;",500:"opacity:1"}),public}(),controller=function(){var a={regEvents:function(){var a=document.getElementById("article");ae("#aside").add({id:"aside-show","final":!0,0:{"margin-left":"-280px"},500:{"margin-left":"0px",curve:"cubic-bezier(0,0,.22,1)"}}),ae("#aside").add({id:"aside-hide","final":!0,0:{"margin-left":"0px"},300:{"margin-left":"-280px",curve:"cubic-bezier(.63,0,1,1)"}}),ae("#float-button").add({id:"fb-hide","final":!0,0:{transform:"rotate(0deg)",opacity:"1"},500:{transform:"rotate(90deg)",opacity:"0"}}),ae("#float-button").add({id:"fb-show","final":!0,0:{height:"0px",width:"0px","border-radius":"0px",right:"44px",bottom:"84px"},500:{height:"56px",width:"56px","border-radius":"28px",right:"16px",bottom:"56px"}}),$(a).on("touchstart",function(a){touchStartY=0===document.body.scrollTop?a.targetTouches[0].pageY:a.targetTouches[0].pageY-document.body.scrollTop}).on("touchmove",function(b){if(touchMoveY=b.targetTouches[0].pageY-touchStartY,0===document.body.scrollTop&&(a.style.marginTop=touchMoveY+"px"),touchMoveY>56){var c=document.getElementById("refresh-text"),d=document.getElementById("refresh-img");c.innerHTML="松开刷新",d.src="./.src/img/refresh.png"}}),a.addEventListener("touchend",function(b){if(a.style.marginTop&&b.stopPropagation(),a.style.marginTop.replace(/px/,"")>56){_pointer=_src,$(".file").remove(),$("#attention").remove(),model.getSrc();var c=document.getElementById("refresh-text"),d=document.getElementById("refresh-img");c.innerHTML="下拉刷新",d.src="./.src/img/down.png"}a.style.marginTop=null},!0),$("#menu").on("tap",function(){ae("#aside").clear().play("aside-show"),view.addMask(),setTimeout(function(){$("#mask").one("tap",function(){ae("#aside").clear().play("aside-hide"),$("#mask").remove()})},0)}),$("#aside").on("tap",function(a){a.stopImmediatePropagation()}),$("#float-button").on("tap",function(){view.addConfirm("欢迎使用本APP！<br>这个按钮只是一个DEMO，<br>您可以在设置中关掉它！<br>作者的邮箱：<br>lianmengdi.f2e@gmail.com",function(){},!0)}),$("#config-hide-checkbox").on("change",function(){this.checked?(_config.hide=!0,model.setConfig(),$(".file").remove(),view.listLoad()):(_config.hide=!1,model.setConfig(),$(".file").remove(),view.listLoad())}),$("#config-sys-checkbox").on("change",function(){this.checked?(_config.sys=!0,model.setConfig(),$(".file").remove(),view.listLoad()):(_config.sys=!1,model.setConfig(),$(".file").remove(),view.listLoad())}),$("#config-floatButton-checkbox").on("change",function(){this.checked?(_config.button=!0,model.setConfig(),$("#float-button").css("display","block"),ae("#float-button").clear().play("fb-show")):(_config.button=!1,model.setConfig(),ae("#float-button").clear().play("fb-hide",function(){$("#float-button").css("display","none")}))}),$("#config-clean").on("tap",function(){view.addConfirm("您真的要清理本地存储吗？<br>此操作将不可恢复",function(){localStorage.clear()})}),$("#config-load").on("tap",function(){_pointer=_src,$(".file").remove(),$("#attention").remove(),model.getSrc()}),$(".config").on("touchstart",function(a){a.currentTarget.style.backgroundColor="#4FC3F7"}).on("touchend",function(a){a.currentTarget.style.backgroundColor="#FFFFFF"}),localStorage.getItem("src")?model.loadSrc():$("#article").append('<div id="attention">未在本地缓存中找到数据<br/>请下拉刷新</div>')}};return a}(),_tree,_src,_pointer,_arrPoint,_config;model.getConfig();